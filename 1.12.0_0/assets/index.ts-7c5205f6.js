import{B as m,e as i,s as c,h as f,i as d,r as u,L as y,j as S,k as L,S as p}from"./const-0b68ee57.js";const w={renderWay:!0,backgroundColor:m,isBeautifyScrollBar:!0,showWordsCount:!0,trialStartDate:i().format("YYYY-MM-DD")};chrome.runtime.onInstalled.addListener(t=>{t.reason===chrome.runtime.OnInstalledReason.INSTALL&&(c(w),f()),chrome.tabs.query({},function(e){for(let n=0;n<e.length;n++){const a=e[n];a!=null&&a.id&&d(a.url)&&chrome.tabs.reload(a.id)}})});const o=new Set;let s=1;const _=async t=>{const e=await u(["activities"]),n=(e==null?void 0:e.activities)||[],a=n.find(r=>r.date===t);a?a.value++:n.push({date:i().format("YYYY-MM-DD"),value:1}),c({activities:n})};chrome.tabs.onUpdated.addListener(function(t,e,n){if(e.url&&d(e.url)){const a=i().date();s!==a&&(s=a,o.clear());const r=new URL(e.url);if(!o.has(r.pathname)){o.add(r.pathname);const h=i().format("YYYY-MM-DD");_(h)}}});function D(t,e){return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(n=>{if(!n.ok)throw new Error("Network response was not ok");return n.json()}).then(n=>n).catch(n=>{})}const l=async t=>new Promise((e,n)=>{t===y?setTimeout(()=>{e({valid:!0,license_key:{test_mode:!0},meta:{store_id:S,product_id:L}})},100+400*Math.random()):D("https://notion-power-web.vercel.app/api/backend",{license_key:t}).then(function(a){e(a)}).catch(function(a){n(a)})});chrome.runtime.onStartup.addListener(async()=>{const t=await u(["licenseKey"]);t!=null&&t.licenseKey&&l(t.licenseKey)});chrome.runtime.onMessage.addListener(function(t,e,n){return(async()=>{if(t!=null&&t.licenseKey){const a=await l(t==null?void 0:t.licenseKey);n({validResult:a})}})(),!0});chrome.windows.onFocusChanged.addListener(function(t){t!==chrome.windows.WINDOW_ID_NONE&&chrome.runtime.sendMessage({action:p}).then(e=>{},e=>{})});chrome.action.onClicked.addListener(async t=>{try{await chrome.scripting.executeScript({target:{tabId:t.id||0},func:()=>{}})}catch{}});
