import{s,e as m,i as d,B as f,h as o,r as u,S as y}from"./const-4e5411b4.js";const w={renderWay:!0,backgroundColor:f,isBeautifyScrollBar:!0,showWordsCount:!0};chrome.runtime.onInstalled.addListener(e=>{e.reason===chrome.runtime.OnInstalledReason.INSTALL&&(s(w),m()),chrome.tabs.query({},function(t){for(let n=0;n<t.length;n++){const a=t[n];a!=null&&a.id&&d(a.url)&&chrome.tabs.reload(a.id)}})});const r=new Set;let c=1;const p=async e=>{const t=await u(["activities"]),n=(t==null?void 0:t.activities)||[],a=n.find(i=>i.date===e);a?a.value++:n.push({date:o().format("YYYY-MM-DD"),value:1}),s({activities:n})};chrome.tabs.onUpdated.addListener(function(e,t,n){if(t.url&&d(t.url)){const a=o().date();c!==a&&(c=a,r.clear());const i=new URL(t.url);if(!r.has(i.pathname)){r.add(i.pathname);const l=o().format("YYYY-MM-DD");p(l)}}});function S(e,t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(n=>{if(!n.ok)throw new Error("Network response was not ok");return n.json()}).then(n=>n).catch(n=>{})}const h=async e=>new Promise((t,n)=>{S("https://notion-power-web.vercel.app/api/backend",{license_key:e}).then(function(a){t(a)}).catch(function(a){n(a)})});chrome.runtime.onStartup.addListener(async()=>{const e=await u(["licenseKey"]);e!=null&&e.licenseKey&&h(e.licenseKey)});chrome.runtime.onMessage.addListener(function(e,t,n){return(async()=>{if(e!=null&&e.licenseKey){const a=await h(e==null?void 0:e.licenseKey);n({validResult:a})}})(),!0});chrome.windows.onFocusChanged.addListener(function(e){e!==chrome.windows.WINDOW_ID_NONE&&chrome.runtime.sendMessage({action:y}).then(t=>{},t=>{})});chrome.action.onClicked.addListener(async e=>{try{await chrome.scripting.executeScript({target:{tabId:e.id||0},func:()=>{}})}catch{}});
